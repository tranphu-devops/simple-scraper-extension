<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Chi ti·∫øt b√†i vi·∫øt</title>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >

  <style>
    body { background: #f7f7f7; }
    #content img { max-width: 100%; height: auto; }

    /* Floating buttons */
    .floating-btn {
      position: fixed;
      right: 16px;
      padding: 12px 16px;
      border-radius: 50px;
      z-index: 9999;
      box-shadow: 0 4px 12px rgba(0,0,0,0.25);
      font-size: 14px;
      border: none;
      color: white;
    }
    #backBtn { bottom: 100px; background: #6c757d; }
    #topBtn { bottom: 40px; background: #28a745; }
    #backBtn:hover, #topBtn:hover { opacity: .85; }

    /* Action buttons */
    #deleteBtn { background: #dc3545; border: none; }
    #originBtn { background: #0069d9; border: none; }
  </style>
</head>

<body>

<nav class="navbar navbar-dark bg-dark mb-3">
  <div class="container-fluid">
    <a class="navbar-brand" href="list.html">Scraped Articles</a>
  </div>
</nav>

<div class="container mb-5">

  <h1 id="title" class="h4">ƒêang t·∫£i b√†i vi·∫øt...</h1>
  <div id="createdAt" class="text-muted small mb-3"></div>

  <!-- Action buttons -->
  <div class="d-flex gap-3 mb-3">
    <button id="originBtn" class="btn btn-primary">üîó Xem b√†i g·ªëc</button>
    <button id="deleteBtn" class="btn btn-danger">üóë X√≥a b√†i vi·∫øt</button>
  </div>

  <div id="content" class="card card-body"></div>
</div>

<!-- Floating buttons -->
<button id="backBtn" class="floating-btn">‚¨Ö Quay l·∫°i</button>
<button id="topBtn" class="floating-btn">‚¨Ü L√™n ƒë·∫ßu</button>

<script>
  const params = new URLSearchParams(window.location.search);
  const id = params.get("id");
  let articleUrl = "";

  document.getElementById("backBtn").onclick = () =>
    (window.location.href = "list.html");

  document.getElementById("topBtn").onclick = () =>
    window.scrollTo({ top: 0, behavior: "smooth" });

  // Xem b√†i g·ªëc
  document.getElementById("originBtn").onclick = () => {
    if (articleUrl) {
      window.open(articleUrl, "_blank");
    }
  };

  // X√≥a b√†i vi·∫øt (soft delete)
  document.getElementById("deleteBtn").onclick = async () => {
    if (!confirm("B·∫°n ch·∫Øc ch·∫Øn mu·ªën x√≥a b√†i vi·∫øt n√†y?")) return;

    const res = await fetch("/api/delete/" + id, { method: "POST" });
    const json = await res.json();

    if (json.ok) {
      alert("ƒê√£ x√≥a b√†i vi·∫øt!");
      window.location.href = "list.html";
    } else {
      alert("L·ªói khi x√≥a b√†i vi·∫øt.");
    }
  };

  async function loadDetail() {
    const res = await fetch("/api/detail/" + id);
    const json = await res.json();

    if (!json.ok) {
      document.getElementById("title").innerText = "Kh√¥ng t√¨m th·∫•y b√†i vi·∫øt.";
      return;
    }

    const data = json.data;

    document.getElementById("title").innerText =
      data.title || "(Kh√¥ng c√≥ ti√™u ƒë·ªÅ)";

    document.getElementById("createdAt").innerText =
      "Ng√†y l∆∞u: " + new Date(data.created_at).toLocaleString();

    articleUrl = data.url; // Save URL for origin link

    document.getElementById("content").innerHTML =
      data.html || "<i>Kh√¥ng c√≥ n·ªôi dung HTML.</i>";
  }

  loadDetail();
</script>

</body>
</html>
